# Correction de problÃ¨me d'IP LoadBalancer Scaleway

# Diagnostic complet du problÃ¨me d'IP LoadBalancer
k8-diagnose-loadbalancer-ip: k8-require-env
  @echo "ğŸ” DIAGNOSTIC IP LOADBALANCER"
  @echo "============================="
  @echo ""
  @echo "ğŸ“‹ Configuration souhaitÃ©e:"
  @echo "IP fixe cible: 51.158.68.116"
  @echo ""
  @echo "ğŸ“‹ Ã‰tat actuel du service Traefik:"
  kubectl get service traefik -n traefik-system -o wide
  @echo ""
  @echo "ğŸ“‹ IP externe attribuÃ©e:"
  kubectl get service traefik -n traefik-system -o jsonpath='{.status.loadBalancer.ingress[0].ip}' 2>/dev/null && echo "" || echo "Pas d'IP trouvÃ©e"
  @echo "ğŸ“‹ Hostname externe attribuÃ©:"
  kubectl get service traefik -n traefik-system -o jsonpath='{.status.loadBalancer.ingress[0].hostname}' 2>/dev/null && echo "" || echo "Pas de hostname trouvÃ©"
  @echo ""
  @echo "ğŸ“‹ Configuration du service (loadBalancerIP):"
  kubectl get service traefik -n traefik-system -o jsonpath='{.spec.loadBalancerIP}' && echo ""
  @echo ""
  @echo "ğŸ“‹ Annotations Scaleway:"
  kubectl get service traefik -n traefik-system -o jsonpath='{.metadata.annotations}' && echo ""

# VÃ©rifier si l'IP fixe est libre dans Scaleway
k8-check-ip-availability: k8-require-env
  @echo "ğŸ” VÃ©rification de la disponibilitÃ© de l'IP fixe..."
  @echo ""
  @echo "ğŸ“‹ IP Ã  vÃ©rifier: 51.158.68.116"
  @echo ""
  @echo "âš ï¸  VÃ©rifiez manuellement dans la console Scaleway:"
  @echo "1. Aller dans 'Network' > 'Load Balancers'"
  @echo "2. VÃ©rifier si l'IP 51.158.68.116 est attachÃ©e Ã  un autre LB"
  @echo "3. Si oui, la dÃ©tacher avant de continuer"
  @echo ""
  @echo "ğŸ“‹ Ã‰tat actuel du cluster:"
  kubectl get service traefik -n traefik-system -o wide
