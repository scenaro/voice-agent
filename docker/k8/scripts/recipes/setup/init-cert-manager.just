# Install cert-manager
k8-init-cert-manager: k8-require-env
  @echo "ğŸ” Installing cert-manager..."
  kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.3/cert-manager.yaml
  @echo "â³ Waiting for cert-manager to be ready..."
  kubectl wait --for=condition=Ready pods --all -n cert-manager --timeout=300s
  @echo "âœ… cert-manager installed successfully!"

# Create ClusterIssuers
k8-setup-cert-issuers: k8-require-env
  @echo "ğŸ­ Creating ClusterIssuers..."
  kubectl apply -f docker/k8/cluster/cert-manager/cluster-issuer.yml
  @echo "âœ… ClusterIssuers created!"

# Create Certificates (optional, ingress can auto-create them)
k8-setup-certificates: k8-require-env
  @echo "ğŸ“œ Creating Certificates..."
  kubectl apply -f docker/k8/cluster/cert-manager/certificates.yml
  @echo "âœ… Certificates created!"

# Full cert-manager setup
k8-setup-cert-manager: k8-require-env k8-init-cert-manager k8-setup-cert-issuers
  @echo "ğŸ¯ cert-manager setup complete!"
  @echo ""
  @echo "ğŸ’¡ Check certificate status with:"
  @echo "   just k8-check-cert-manager"
  @echo ""
  @echo "ğŸ’¡ Or check specific certificates:"
  @echo "   kubectl get certificates -n scenaro-voice-agent"
  @echo "   kubectl describe certificate voice-agent-tls -n scenaro-voice-agent"
  @echo "   kubectl describe certificate traefik-dashboard-tls -n scenaro-voice-agent"

# Check cert-manager status
k8-check-cert-manager: k8-require-env
  @echo "ğŸ” Checking cert-manager status..."
  kubectl get pods -n cert-manager
  @echo ""
  @echo "ğŸ“‹ ClusterIssuers:"
  kubectl get clusterissuers
  @echo ""
  @echo "ğŸ“œ Certificates:"
  kubectl get certificates -A