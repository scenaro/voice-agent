konfig: k8-require-env
  @echo "$KUBECONFIG"

# Exporter le kubeconfig dans le shell courant. `eval $(just use-konfig)`
use-konfig: k8-require-env
  @echo "ğŸ”§ Copier le contenu du kubeconfig dans le shell courant :"
  @echo "export KUBECONFIG=${KUBECONFIG}"

k9s: k8-require-env
  bash -c k9s

kubectl +CMD: k8-require-env
  kubectl {{CMD}}

helm +CMD: k8-require-env
  helm {{CMD}}

docker +CMD: k8-require-env
  docker {{CMD}}

# Status du dÃ©ploiement
k8-status: k8-require-env
  @echo "ğŸ“Š Kubernetes deployment status:"
  @echo "\nğŸ·ï¸  Namespaces:"
  kubectl get namespaces | grep -E "(scenaro|traefik)"
  @echo "\nğŸ³ Pods:"
  kubectl get pods -n scenaro-voice-agent -o wide
  @echo "\nğŸ”Œ Services:"
  kubectl get services -n scenaro-voice-agent
  @echo "\nğŸŒ Ingress:"
  kubectl get ingress -n scenaro-voice-agent
  @echo "\nğŸ” Certificates:"
  kubectl get certificates -n scenaro-voice-agent || echo "No certificates found"


# Test de connectivitÃ© rÃ©seau
k8-test-network: k8-require-env
  @echo "ğŸ” Testing network connectivity..."
  @echo "Frontend to Agent:"
  kubectl exec -n scenaro-voice-agent $(kubectl get pods -n scenaro-voice-agent -l app=front -o jsonpath='{.items[0].metadata.name}') -- wget -qO- --timeout=5 http://agent-service:7880/health || echo "âŒ Frontend cannot reach Agent"

k8-images-ls: k8-require-env
 kubectl kustomize docker/k8/apps/overlays/staging | grep -A5 -B5 "image:"
